<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Complete separation - Adaptable code</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Complete separation";
        var mkdocs_page_input_path = "3-separate-interfaces-functionality.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/php.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> Adaptable code
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Home</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../0-look-at-this/">Look at this</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../1-first-separation/">First separation</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../2-separate-interfaces-subject/">Second separation</a>
                </li>
              </ul>
              <ul class="current">
                <li class="toctree-l1 current"><a class="reference internal current" href="#">Complete separation</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../4-large-clients/">Separate implementation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Testing</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../testing/mocks-vs-fakes/">Mocks vs Fakes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../testing/fakes-in-memory/">Fake: In Memory</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../testing/fakes-database/">Fake: Database</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../testing/mutability-fakes/">Fake: Support mutability</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Considerations</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../considerations/when-introduce/">When to introduce</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../considerations/when-split/">When to split up</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../considerations/cant-see-implementation/">But I can't see</a>
                  </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../13-outro/">Conclusion</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">Adaptable code</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">Complete separation</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <p>Jump in time, we have all remote CRUD methods now, so we have a controller like this</p>
<pre><code class="language-php">class RemoteLicenseController extends Controller
{

    public function index(App\Person $person, RemoteLicenseClientInterface $client): Response { ... }

    public function create(): Response { .. }

    public function store(Request $request, RemoteLicenseClientInterface $client): Response {

        $licenseDto = $this-&gt;someTransformation($request); // just go with it
        ...
        $license = $client-&gt;createLicense($licenseDto);

        return response()-&gt;redirect('license.index');
    }

    public function edit(): Response { .. }
    public function update(Request $request, RemoteLicenseClientInterface $client): Response { .. }

}
</code></pre>
<p>We update our client interfaces accordingly:</p>
<pre><code class="language-php">interface RemotePersonClientInterface {   

    public function createPerson(string PersonDto $person): Person;

    public function updatePerson(string PersonDto $person): bool;   

    public function deletePerson(string PersonDto $person): bool;


    /** @return PersonDto[] $people */
    public function getPeopleInGroup(string Group $group): array;

}

interface RemoteLicenseClientInterface {

    public function createLicense(string LicenseDto $license): License;

    public function updateLicense(string LicenseDto $license): bool;

    public function deleteLicense(string LicenseDto $license): bool;    

    public function assignLicenseToPerson(string Person $person, LicenseDto $license): bool;

    public function removeLicenseFromPerson(string Person $person, LicenseDto $license): bool;

    /** @return LicenseDto[] $licenses */
    public function getLicensesForPerson(string Person $person): array;
}
</code></pre>
<p>But, when we want to implement those methods, we realize we don't want to support CRUD methods for AFAS Licenses, nor for Google People.
All customers using those, handle their updating outside of our application, not much sense writing support for it just to comply with the interfaces.</p>
<p>We can split up the interfaces for their specific use cases</p>
<pre><code class="language-php">interface ListRemotePersonClientInterface { 

    /** @return PersonDto[] $people */
    public function getPeopleInGroup(string Group $group): array;
}

interface ListRemoteLicenseClientInterface {

    /** @return LicenseDto[] $licenses */
    public function getLicensesForPerson(string Person $person): array;
}

interface EditRemotePersonClientInterface {

    public function createPerson(string PersonDto $person): Person;

    public function updatePerson(string PersonDto $person): bool;

    public function deletePerson(string PersonDto $person): bool;
}

interface EditRemoteLicenseClientInterface {

    public function createLicense(string LicenseDto $license): License;

    public function updateLicense(string LicenseDto $license): bool;

    public function deleteLicense(string LicenseDto $license): bool;

    public function assignLicenseToPerson(string Person $person, LicenseDto $license): bool;

    public function removeLicenseFromPerson(string Person $person, LicenseDto $license): bool;
}
</code></pre>
<p>Note: depending on the situation it's likely the Edit-version always needs to support Listing, so you could opt for<br />
<code>EditRemotePersonClientInterface extends ListRemotePersonClientInterface</code>
For the purpose of this presentation they're considered as completed separate.</p>
<p>We make sure the clients implement only what they support</p>
<pre><code class="language-php">class \App\Clients\Microsoft implements
    ListRemotePersonClientInterface,
    EditRemotePersonClientInterface,
    ListRemoteLicenseClientInterface,
    EditRemoteLicenseClientInterface { ... }


class \App\Clients\Google implements ListRemotePersonClientInterface { ... }
class \App\Clients\Afas implements ListRemoteLicenseInterface { ... }
</code></pre>
<p>Controllers can fairly easily* be updated</p>
<pre><code class="language-php">class RemotePersonController extends Controller
{
    public function index(App\Person $person, ListRemotePersonClientInterface $client): Response { ... }

    public function create(): Response { ... }    

    public function store(Request $request, EditRemotePersonClientInterface $client): Response { ... }

    public function edit(): Response { ... }

    public function update(Request $request, EditRemotePersonClientInterface $client): Response { ... }
}
</code></pre>
<pre><code class="language-php">class RemoteLicenseController extends Controller
{
    public function index(App\Person $person, ListRemoteLicenseClientInterface $client): Response { ... }

    public function create(): Response { ... }    

    public function store(Request $request, EditRemoteLicenseClientInterface $client): Response { ... }

    public function edit(): Response { ... }

    public function update(Request $request, EditRemoteLicenseClientInterface $client): Response { ... }
}
</code></pre>
<p>* Some DI tomfoolery is required</p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../2-separate-interfaces-subject/" class="btn btn-neutral float-left" title="Second separation"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../4-large-clients/" class="btn btn-neutral float-right" title="Separate implementation">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../2-separate-interfaces-subject/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../4-large-clients/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
